<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/pages/template/default.xhtml"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:pe="http://primefaces.org/ui/extensions">

	<ui:define name="content">
		<p:breadCrumb>
		    <p:menuitem value="#{message['pao.home']}" url="#" />
		   	<p:menuitem value="#{message['pao.projeto']}"
				outcome="pretty:projeto"/>
			<p:menuitem value="#{message['pao.alocacao']}"
				outcome="pretty:alocacao" disabled="true" />
		</p:breadCrumb>
		<div>
			<h2>#{message['title.alocacao']}</h2>
			<p:growl id="growl" life="4000" globalOnly="true" sticky="true" />
			<h:form>
				<br />
				
				<p:selectOneMenu styleClass="dropdown-pesquisa"
								id="celula"
							 	value="#{alocacaoManager.celula}"
							 	
							 	valueChangeListener="#{alocacaoManager.valueChangeCelula}"
								converter="entityConverterSelectOneMenu" >
					<f:selectItem itemLabel="#{message['select.celula']}" noSelectionOption="true" />
					<f:selectItems value="#{celulaManager.listarAtivos()}"
								var="celula"
								itemLabel="#{celula.nome}"
								itemValue="#{celula}" />
					<p:ajax update="gridRecursos gridProjetos" event="change" process="@this" />
				</p:selectOneMenu>
				
				<p:selectOneMenu styleClass="dropdown-pesquisa"
								id="equipe"
							 	value="#{alocacaoManager.equipe}"
							 	
							 	valueChangeListener="#{alocacaoManager.valueChangeEquipe}"
								converter="entityConverterSelectOneMenu" >
					<f:selectItem itemLabel="#{message['select.equipe']}" noSelectionOption="true" />
					<f:selectItems value="#{equipeManager.listarAtivos()}"
								var="equipe"
								itemLabel="#{equipe.nome}"
								itemValue="#{equipe}" />
					<p:ajax update="gridRecursos gridProjetos" event="change" process="@this" />	
				</p:selectOneMenu>
				
				
				<br/><br/><br/>
				<h3>#{message['title.recurso.ativo']}</h3>
					
					<p:dataTable id="gridRecursos" 
								var="recurso"
								value="#{alocacaoManager.listaRecursosAtivos}"
								emptyMessage="#{message['alerta.listaVazia']}">
						
						<p:column headerText="#{message['label.profissional.matricula']}" for="recursoMatricula">
							<h:outputText value="#{recurso.profissional.matricula}" id="recursoMatricula"/>
						</p:column>
						
						<p:column headerText="#{message['label.nome']}" for="recursoNome">
							<h:outputText value="#{recurso.profissional.nome}" id="recursoNome"/>
						</p:column>
						
						<p:column headerText="#{message['label.profissional.cargo']}" for="recursoCargo">
							<h:outputText value="#{recurso.profissional.cargo.nome}" id="recursoCargo" />
						</p:column>
					
						<p:column headerText="#{message['label.cargaHoraria']}" for="recursoCargaHoraria" >
							<h:outputText value="#{recurso.profissional.cargaHoraria.cargaHoraria}" id="recursoCargaHoraria">
								<f:converter converterId="cargaHorariaConverter"/>
							</h:outputText>
						</p:column>
							
						<p:column headerText="#{message['label.profissional.valorHora']}" for="recursoValorHora">
							<h:outputText value="#{recurso.profissional.valorHora}" id="recursoValorHora"/>
						</p:column>
					</p:dataTable>
				
				<br />
				<h3>Projetos</h3>
				
					<h:outputLabel value="Adicionar Recurso ao Projeto: "/>
					<p:inputMask styleClass="input-pesquisa" mask="999999" value="#{alocacaoManager.matriculaRecurso}" 
					pt:placeholder="Cod. Projeto" />
					<p:inputMask styleClass="input-pesquisa" mask="999999" value="#{alocacaoManager.matriculaRecurso}" 
					pt:placeholder="Matrícula" />
					
      					<p:calendar pt:placeholder="Data de Início" id="inicio" value="#{alocacaoManager.alocacao.dataInicio}" pattern="dd/MM/yyyy" mask="true" showOn="button" required="true" requiredMessage="#{message['span.obrigatorio.dataInicio']}" disabledWeekends="true"/>
					
					<p:commandButton id="alocarRecurso" icon="ui-icon-search" 
						actionListener="#{alocacaoManager.alocarRecurso(projeto.codigo)}">
					</p:commandButton>
					
					<p:dataTable id="gridProjetos" 
								var="projeto"
								value="#{alocacaoManager.listaProjetosEAlocacoes}"
								emptyMessage="#{message['alerta.listaVazia']}">
					
						<p:subTable var="recurso" value="#{projeto.recursosDoProjeto}">
							
							<p:columnGroup type="header">
					            <p:row>
					                <p:column headerText="#{projeto.codigo}" />
					                <p:column headerText="Budget:" />
					                <p:column colspan="3" headerText="R$ #{projeto.budget}" />
					                
					            </p:row>
					            <p:row>
					            	<p:column rowspan="2" headerText="#{projeto.nome}" />
					                <p:column headerText="Custo:" />
					                <p:column colspan="3" headerText="R$ #{projeto.custoPrevisto}" />
					            </p:row>
					            <p:row>
					                <p:column headerText="Saldo:" />
					                <p:column colspan="3"  headerText="R$ #{projeto.saldo}"/>
					            </p:row>
					            
					            <p:row>
					            	<p:column headerText="#{message['label.profissional.matricula']}"/>
					            	<p:column headerText="Matricula"/>
					            	<p:column headerText="#{message['label.nome']}"/>
					            	<p:column headerText="#{message['label.profissional.cargo']}"/>
					            	<p:column headerText="#{message['label.profissional.valorHora']}"/>
					            	<p:column headerText="Carga Horária"/>	
					            	<p:column headerText="Açoes"/>/>					           
					            </p:row>
					        </p:columnGroup>
				
							<p:column headerText="#{message['label.profissional.matricula']}">
								<h:outputText value="#{recurso.profissional.matricula}" />
							</p:column>
				
							<p:column headerText="#{message['label.nome']}">
								<h:outputText value="#{recurso.profissional.nome}" />
							</p:column>
		
							<p:column headerText="#{message['label.profissional.cargo']}">
								<h:outputText value="#{recurso.profissional.cargo.nome}" />
							</p:column>
							
							<p:column headerText="#{message['label.profissional.valorHora']}">
								<h:outputText value="#{recurso.profissional.valorHora}" />
							</p:column>
		
							<p:column headerText="Carga Horária">
								<h:outputText value="#{recurso.profissional.cargaHoraria.cargaHoraria}">
									<f:convertNumber minFractionDigits="2" type="currency"
										currencySymbol="R$" />
								</h:outputText>
								
							</p:column>
							
							<p:column>
							<p:commandButton id="desativarRecurso" styleClass="btn-acao"
						icon="ui-icon-closethick"
						action="#{alocacaoManager.desativar(recurso.profissional.matricula)}"
						/>
						
				
						</p:column>
							<f:facet name="footer">
								
								<h:outputLabel value=" " /><br/>
								<h:outputLabel value=" " /><br/>
								<h:outputLabel value=" " /><br/>
								<h:outputLabel value=" " />
								
							</f:facet>
						        
						</p:subTable>												
					</p:dataTable>
								
			</h:form>
			</div>		
	</ui:define>

</ui:composition>